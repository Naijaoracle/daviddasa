<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Agent-Based Disease Spread Simulator - Public Health Modeling">
  <title>Epidemic Spread Simulator - David Dasa</title>
  <link rel="icon" type="image/svg+xml" href="/src/favicon-DD-monogram.svg">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .sim-layout {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 2rem;
      margin: 2rem auto;
      max-width: 1200px;
    }

    .controls {
      background: rgba(255,255,255,0.82);
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
    }

    .canvas-container {
      background: #f8f9fa;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
      position: relative;
      height: 500px;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    .control-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #092917;
      font-size: 0.9rem;
    }

    input[type="range"] {
      width: 100%;
      accent-color: #2ecc71;
    }

    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat-item {
      text-align: center;
      padding: 0.5rem;
      background: white;
      border-radius: 0.5rem;
      border: 1px solid #eee;
    }

    .stat-val { font-size: 1.2rem; font-weight: 700; }
    .stat-label { font-size: 0.7rem; color: #666; text-transform: uppercase; }

    .color-s { color: #3498db; } /* Susceptible */
    .color-i { color: #e74c3c; } /* Infected */
    .color-r { color: #27ae60; } /* Recovered */
    .color-v { color: #9b59b6; } /* Vaccinated */

    .btn {
      width: 100%;
      padding: 0.8rem;
      border: none;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 0.5rem;
      transition: opacity 0.2s;
    }

    .btn-primary { background: #2ecc71; color: white; }
    .btn-secondary { background: #e0e0e0; color: #333; }
    .btn:hover { opacity: 0.9; }

    .chart-container {
      margin-top: 1rem;
      height: 150px;
      background: white;
      padding: 0.5rem;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
  <nav>
    <ul>
      <li class="logo"><a href="https://www.daviddasa.com"><img src="https://github.com/Naijaoracle/daviddasa/blob/9556670c224c56b73e2a7f21ce1a4e27cbc1a90e/src/DD_logo.png?raw=true" alt="Logo" width="50" height="50"></a></li>
      <li class="home-link"><a href="https://www.daviddasa.com/">Home</a></li>
      <li><a href="https://www.daviddasa.com/projects">Projects</a></li>
    </ul>
  </nav>

  <!-- Particles Background -->
  <div id="particles-js"></div>

  <div class="container" style="margin-top: 2rem;">
    <div class="article-header">
      <h1>ü¶† Epidemic Spread Simulator</h1>
      <p>Agent-based modeling of disease transmission dynamics. Adjust parameters to visualize the impact of social distancing and vaccination on "flattening the curve."</p>
    </div>

    <div class="sim-layout">
      <div class="controls">
        <div class="stats">
          <div class="stat-item">
            <div class="stat-val color-s" id="count-s">0</div>
            <div class="stat-label">Susceptible</div>
          </div>
          <div class="stat-item">
            <div class="stat-val color-i" id="count-i">0</div>
            <div class="stat-label">Infected</div>
          </div>
          <div class="stat-item">
            <div class="stat-val color-r" id="count-r">0</div>
            <div class="stat-label">Recovered</div>
          </div>
          <div class="stat-item">
            <div class="stat-val color-v" id="count-v">0</div>
            <div class="stat-label">Vaccinated</div>
          </div>
        </div>

        <div class="chart-container">
          <canvas id="epi-curve"></canvas>
        </div>

        <div class="control-group" style="margin-top:1rem;">
          <label>Transmission Rate (R0 proxy)</label>
          <input type="range" id="infection-radius" min="5" max="30" value="12">
        </div>

        <div class="control-group">
          <label>Social Distancing (% Stationary)</label>
          <input type="range" id="distancing" min="0" max="95" value="0">
        </div>

        <div class="control-group">
          <label>Vaccination Rate (%)</label>
          <input type="range" id="vaccination" min="0" max="90" value="0">
        </div>

        <button class="btn btn-primary" onclick="restartSim()">‚Ü∫ Restart Simulation</button>
        <button class="btn btn-secondary" onclick="togglePause()">‚èØ Pause / Resume</button>
      </div>

      <div class="canvas-container" id="canvas-wrap">
        <canvas id="sim-canvas"></canvas>
      </div>
    </div>
  </div>

  <script>
    // Simulation Parameters
    const POPULATION = 200;
    const SPEED = 2;
    let RECOVERY_TIME = 300; // Frames
    
    // State
    let agents = [];
    let animationId;
    let isPaused = false;
    let canvas, ctx;
    let width, height;
    
    // Chart
    let chart;
    let historyS = [], historyI = [], historyR = [];

    class Agent {
      constructor(status = 'S') {
        this.x = Math.random() * width;
        this.y = Math.random() * height;
        const angle = Math.random() * Math.PI * 2;
        this.vx = Math.cos(angle) * SPEED;
        this.vy = Math.sin(angle) * SPEED;
        this.status = status; // S, I, R
        this.timer = 0;
        this.isDistancing = Math.random() * 100 < parseInt(document.getElementById('distancing').value);
      }

      update() {
        if (!this.isDistancing) {
          this.x += this.vx;
          this.y += this.vy;

          // Bounce
          if (this.x < 0 || this.x > width) this.vx *= -1;
          if (this.y < 0 || this.y > height) this.vy *= -1;
        }

        // Recovery
        if (this.status === 'I') {
          this.timer++;
          if (this.timer > RECOVERY_TIME) {
            this.status = 'R';
          }
        }
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
        
        let color;
        if (this.status === 'S') color = '#3498db';
        else if (this.status === 'I') color = '#e74c3c';
        else if (this.status === 'R') color = '#27ae60';
        else if (this.status === 'V') color = '#9b59b6';
        
        ctx.fillStyle = color;
        ctx.fill();
      }
    }

    function initSim() {
      canvas = document.getElementById('sim-canvas');
      const wrap = document.getElementById('canvas-wrap');
      width = canvas.width = wrap.clientWidth;
      height = canvas.height = wrap.clientHeight;
      ctx = canvas.getContext('2d');

      agents = [];
      const vaccRate = parseInt(document.getElementById('vaccination').value);
      
      // Init Agents
      for (let i = 0; i < POPULATION; i++) {
        let status = 'S';
        if (i < 3) {
          status = 'I'; // Ensure at least 3 infected to start
        } else {
          if (Math.random() * 100 < vaccRate) {
            status = 'V';
          }
        }
        agents.push(new Agent(status));
      }

      historyS = []; historyI = []; historyR = [];
      initChart();
      loop();
    }

    function loop() {
      if (!isPaused) {
        update();
        draw();
        updateStats();
      }
      animationId = requestAnimationFrame(loop);
    }

    function update() {
      const radius = parseInt(document.getElementById('infection-radius').value);
      const distancingRate = parseInt(document.getElementById('distancing').value);

      // Update distancing dynamically
      agents.forEach(a => {
        // Re-roll distancing behavior occasionally to reflect policy changes
        if(Math.random() < 0.01) a.isDistancing = Math.random() * 100 < distancingRate;
        a.update();
      });

      // Collision / Transmission
      for (let i = 0; i < agents.length; i++) {
        if (agents[i].status !== 'I') continue;

        for (let j = 0; j < agents.length; j++) {
          if (agents[j].status !== 'S') continue;

          const dx = agents[i].x - agents[j].x;
          const dy = agents[i].y - agents[j].y;
          const dist = Math.sqrt(dx * dx + dy * dy);

          if (dist < radius) {
            agents[j].status = 'I';
          }
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, width, height);
      agents.forEach(a => a.draw());
    }

    function updateStats() {
      const s = agents.filter(a => a.status === 'S').length;
      const i = agents.filter(a => a.status === 'I').length;
      const r = agents.filter(a => a.status === 'R').length;
      const v = agents.filter(a => a.status === 'V').length;

      document.getElementById('count-s').textContent = s;
      document.getElementById('count-i').textContent = i;
      document.getElementById('count-r').textContent = r;
      document.getElementById('count-v').textContent = v;

      // Update Chart every 10 frames
      if (animationId % 10 === 0) {
        chart.data.labels.push('');
        chart.data.datasets[0].data.push(i); // Infected
        
        // Keep chart window moving
        if(chart.data.labels.length > 100) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
        }
        chart.update('none');
      }
    }

    function initChart() {
        if(chart) chart.destroy();
        const ctx = document.getElementById('epi-curve').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Active Cases',
                    data: [],
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { display: false },
                    y: { beginAtZero: true, max: POPULATION }
                },
                animation: false
            }
        });
    }

    function restartSim() {
      cancelAnimationFrame(animationId);
      initSim();
    }

    function togglePause() {
      isPaused = !isPaused;
    }

    // Start
    window.addEventListener('load', initSim);
    window.addEventListener('resize', () => {
        width = canvas.width = document.getElementById('canvas-wrap').clientWidth;
        height = canvas.height = document.getElementById('canvas-wrap').clientHeight;
    });

    // Initialize particles
    document.addEventListener("DOMContentLoaded", () => {
      particlesJS('particles-js', {
        particles: {
          number: { value: 60, density: { enable: true, value_area: 800 } },
          color: { value: '#2ecc71' },
          shape: { type: 'circle' },
          opacity: { value: 0.4, random: false },
          size: { value: 3, random: true },
          line_linked: {
            enable: true,
            distance: 150,
            color: '#2ecc71',
            opacity: 0.2,
            width: 1
          },
          move: {
            enable: true,
            speed: 1.5,
            direction: 'none',
            random: false,
            straight: false,
            out_mode: 'out',
            bounce: false,
          }
        },
        interactivity: {
          detect_on: 'canvas',
          events: {
            onhover: { enable: true, mode: 'repulse' },
            onclick: { enable: true, mode: 'push' },
            resize: true
          }
        },
        retina_detect: true
      });
    });
  </script>

  <!-- Footer -->
  <footer>
    <p><strong>Disclaimer:</strong> This tool is for demonstration purposes only. It does not provide medical diagnosis, treatment, or clinical decision support. The simulation is a simplified model and should not be used for public health planning or policy decisions. Not intended for clinical use.</p>
    <p>&copy; 2025 David Dasa</p>
  </footer>
</body>
</html>

