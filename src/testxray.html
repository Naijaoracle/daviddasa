<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contact - David Dasa</title>
  <!-- CSS file goes here -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- Navigation Section -->
  <nav>
    <ul>
      <li class="logo"><a href="https://www.daviddasa.com"><img src="https://github.com/Naijaoracle/static_web_app/blob/main/src/DD_logo.png?raw=true" alt="Logo" width="50" height="50"></a></li>
      <li class="home-link"><a href="https://www.daviddasa.com/">Home</a></li>
      <li><a href="https://www.daviddasa.com/about">About</a></li>
      <li><a href="https://www.daviddasa.com/projects">Projects</a></li>
      <li><a href="https://www.daviddasa.com/skills">Skills</a></li>
      <li><a href="#contact">Contact</a></li>
    </ul>
  </nav>

  <div class="container">
    <h1>Upload your x-ray image file for testing</h1>
    <!-- Body -->
    <section id="contact">
    <p>Upload below.</p>
    <p>Note! This is not to be used for clinical use or for use in any production environment.</p>
    <p>Please get in touch if you have any enquiries: <a href="https://www.linkedin.com/in/daviddasa">LinkedIn | David Dasa</a></p>
    <form id="imageUploadForm" action="https://daviddasa.azurewebsites.net/api/HttpInitTrigger?" method="post" enctype="multipart/form-data">
        <input type="file" name="imageFile" accept=".jpg,.jpeg,.png,.gif"> <!-- Only image files -->
        <input type="submit" value="Upload">
    </form>
  <script>
    window.addEventListener('DOMContentLoaded', (event) => {
      const form = document.getElementById('imageUploadForm');
      const fileInput = document.getElementById('fileInput');
      const submitButton = document.getElementById('submitButton');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const file = fileInput.files[0];
        if (!file) {
          alert('Please select a file.');
          return;
        }

        const formData = new FormData();
        formData.append('file', file);

        submitButton.disabled = true; // Disable the button during submission

        try {
          // Your blob storage URL for uploading the image
          const response = await fetch('https://csb10032002a3ba9f46.blob.core.windows.net/azure-webjobs-hosts/tbxray_storageblob/', {
            method: 'PUT',
            body: file,
            headers: {
              'Content-Type': file.type
            }
          });

          if (response.ok) {
            // File uploaded to Blob Storage, trigger Azure Function
            const functionResponse = await fetch('https://daviddasa.azurewebsites.net/api/HttpInitTrigger?', {
              method: 'POST',
              body: formData
            });

            if (functionResponse.ok) {
              const result = await functionResponse.json();
              alert('Prediction result: ' + JSON.stringify(result));
            } else {
              alert('Failed to trigger Azure Function.');
            }

            form.reset(); // Reset the form to clear the file input
          } else {
            alert('Failed to upload image to Blob Storage.');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred. Please try again later.');
        } finally {
          submitButton.disabled = false; // Enable the button after processing
        }
      });
    });
  </script>
  
    <!-- Additional information or messages can be added here -->
    </section>
  </div>

  <!-- Footer Section -->
  <footer>
    <p>&copy; 2023 David Dasa</p>
  </footer>
</body>
</html>
