<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Interactive Drug Interaction Visualizer - Network Graph">
  <title>Drug Interaction Visualizer - David Dasa</title>
  <link rel="icon" type="image/svg+xml" href="/src/favicon-DD-monogram.svg">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    .viz-container {
      /* Remnant style, using .container now */
    }
    
    .container {
       max-width: 1400px;
       margin-top: 2rem;
    }
    
    .article-header {
      background: rgba(255,255,255,0.82);
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 1rem;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
      padding: 2rem;
      margin-bottom: 2rem;
    }
    
    .controls {
      background: rgba(255,255,255,0.82);
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 1rem;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
    }
    
    #mynetwork {
      background: rgba(255,255,255,0.82);
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 1rem;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
    }
    
    .viz-layout {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 1.5rem;
      margin-top: 2rem;
      height: 500px;
      min-height: 500px;
    }

    @media (max-width: 900px) {
      .viz-layout {
        grid-template-columns: 1fr;
        height: auto;
      }
      #mynetwork {
        height: 450px;
        order: -1;
      }
      .controls {
        max-height: 400px;
        overflow-y: auto;
      }
    }
    
    .controls {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      overflow-y: auto;
      max-height: 100%;
    }

    .search-box {
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid #ddd;
      border-radius: 0.5rem;
      font-size: 1rem;
    }

    .med-list {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 0.5rem;
      background: white;
      max-height: 150px;
      min-height: 100px;
    }

    .med-item {
      padding: 0.8rem;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .med-item:hover {
      background: #f9f9f9;
    }

    .med-item button {
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 12px;
    }

    #mynetwork {
      width: 100%;
      height: 100%;
      border: 1px solid #eee;
      border-radius: 0.5rem;
      background: #fcfcfc;
      min-height: 480px;
    }

    .interaction-alert {
      margin-top: 1rem;
      padding: 1rem;
      background: #fdedec;
      border: 1px solid #fadbd8;
      border-radius: 0.5rem;
      color: #c0392b;
      font-size: 0.9rem;
      display: none;
      max-height: 200px;
      overflow-y: auto;
      word-wrap: break-word;
    }

    .severity-high { color: #c0392b; font-weight: bold; }
    .severity-mod { color: #d35400; }
  </style>
</head>
<body>
  <nav>
    <ul>
      <li class="logo"><a href="https://www.daviddasa.com"><img src="https://github.com/Naijaoracle/daviddasa/blob/9556670c224c56b73e2a7f21ce1a4e27cbc1a90e/src/DD_logo.png?raw=true" alt="Logo" width="50" height="50"></a></li>
      <li class="home-link"><a href="https://www.daviddasa.com/">Home</a></li>
      <li><a href="https://www.daviddasa.com/projects">Projects</a></li>
    </ul>
  </nav>

  <!-- Particles Background -->
  <div id="particles-js"></div>

  <div class="container">
    <div class="article-header">
      <h1>üíä Drug Interaction Visualizer</h1>
      <p>Interactive network graph demonstrating polypharmacy risks. Add medications to visualize potential interactions and severity levels.</p>
    </div>

    <div class="viz-layout">
      <div class="controls">
        <div class="search-box">
          <input type="text" class="search-input" id="drug-search" placeholder="Add medication (e.g. Warfarin)..." list="drug-options" onkeypress="if(event.key==='Enter') addDrugFromInput()">
          <datalist id="drug-options">
            <!-- Top 30 Common Drugs -->
            <option value="Atorvastatin">
            <option value="Levothyroxine">
            <option value="Metformin">
            <option value="Lisinopril">
            <option value="Amlodipine">
            <option value="Metoprolol">
            <option value="Albuterol">
            <option value="Omeprazole">
            <option value="Losartan">
            <option value="Gabapentin">
            <option value="Hydrochlorothiazide">
            <option value="Sertraline">
            <option value="Simvastatin">
            <option value="Montelukast">
            <option value="Escitalopram">
            <option value="Acetaminophen">
            <option value="Alprazolam">
            <option value="Fluticasone">
            <option value="Bupropion">
            <option value="Furosemide">
            <option value="Pantoprazole">
            <option value="Trazodone">
            <option value="Dextroamphetamine">
            <option value="Duloxetine">
            <option value="Meloxicam">
            <option value="Warfarin">
            <option value="Clopidogrel">
            <option value="Aspirin">
            <option value="Ibuprofen">
            <option value="Naproxen">
            <option value="Tramadol">
            <option value="Citalopram">
            <option value="Prednisone">
            <option value="Potassium">
          </datalist>
          <button onclick="addDrugFromInput()" style="width:100%; margin-top:0.5rem; padding:0.6rem; background:#2ecc71; color:white; border:none; border-radius:0.5rem; cursor:pointer;">+ Add Drug</button>
        </div>

        <h3>Current Meds</h3>
        <div class="med-list" id="med-list">
          <!-- Added meds go here -->
        </div>

        <div class="interaction-alert" id="alert-box">
          <strong>‚ö†Ô∏è Interaction Alert</strong>
          <div id="alert-content"></div>
        </div>
      </div>

      <div id="mynetwork"></div>
    </div>
  </div>

  <script>
    // Knowledge Graph - Expanded Drug Interaction Database (Top 30 Focus)
    const INTERACTIONS = [
      // Anticoagulant / Antiplatelet Risks
      { source: 'Warfarin', target: 'Aspirin', severity: 'High', mechanism: 'Increased bleeding risk' },
      { source: 'Warfarin', target: 'Ibuprofen', severity: 'High', mechanism: 'GI bleeding risk' },
      { source: 'Warfarin', target: 'Naproxen', severity: 'High', mechanism: 'GI bleeding risk' },
      { source: 'Warfarin', target: 'Acetaminophen', severity: 'Moderate', mechanism: 'Increased INR/Bleeding risk' },
      { source: 'Warfarin', target: 'Simvastatin', severity: 'Moderate', mechanism: 'Increased bleeding risk' },
      { source: 'Warfarin', target: 'Omeprazole', severity: 'Moderate', mechanism: 'Increased Warfarin effect' },
      { source: 'Warfarin', target: 'Sertraline', severity: 'Moderate', mechanism: 'Increased bleeding risk' },
      { source: 'Warfarin', target: 'Citalopram', severity: 'Moderate', mechanism: 'Increased bleeding risk' },
      { source: 'Clopidogrel', target: 'Omeprazole', severity: 'High', mechanism: 'Reduced antiplatelet effect' },
      { source: 'Clopidogrel', target: 'Aspirin', severity: 'Moderate', mechanism: 'Increased bleeding risk' },
      { source: 'Clopidogrel', target: 'Naproxen', severity: 'High', mechanism: 'GI bleeding risk' },

      // NSAID Interactions
      { source: 'Ibuprofen', target: 'Aspirin', severity: 'Moderate', mechanism: 'Reduced cardioprotection' },
      { source: 'Ibuprofen', target: 'Lisinopril', severity: 'Moderate', mechanism: 'Reduced antihypertensive effect & Renal risk' },
      { source: 'Ibuprofen', target: 'Losartan', severity: 'Moderate', mechanism: 'Reduced antihypertensive effect & Renal risk' },
      { source: 'Ibuprofen', target: 'Hydrochlorothiazide', severity: 'Moderate', mechanism: 'Reduced diuretic effect & Renal risk' },
      { source: 'Ibuprofen', target: 'Sertraline', severity: 'Moderate', mechanism: 'Increased GI bleeding risk' },
      { source: 'Naproxen', target: 'Lisinopril', severity: 'Moderate', mechanism: 'Reduced antihypertensive effect & Renal risk' },
      
      // ACE Inhibitor / ARB / Diuretic (Renal/Electrolyte)
      { source: 'Lisinopril', target: 'Potassium', severity: 'High', mechanism: 'Hyperkalemia risk' },
      { source: 'Losartan', target: 'Potassium', severity: 'High', mechanism: 'Hyperkalemia risk' },
      { source: 'Warfarin', target: 'Potassium', severity: 'Moderate', mechanism: 'Monitor INR - electrolyte changes can affect anticoagulation' },
      { source: 'Lisinopril', target: 'Metformin', severity: 'Moderate', mechanism: 'Lactic acidosis risk (rare)' },
      { source: 'Hydrochlorothiazide', target: 'Lisinopril', severity: 'Low', mechanism: 'Synergistic hypotension (Usually desired)' },
      
      // Statin Interactions
      { source: 'Simvastatin', target: 'Amlodipine', severity: 'Moderate', mechanism: 'Increased Myopathy risk (>20mg Simva)' },
      { source: 'Atorvastatin', target: 'Clarithromycin', severity: 'High', mechanism: 'Increased Statin toxicity' },
      
      // Serotonin Syndrome Risks
      { source: 'Sertraline', target: 'Tramadol', severity: 'High', mechanism: 'Serotonin Syndrome risk' },
      { source: 'Sertraline', target: 'Dextroamphetamine', severity: 'High', mechanism: 'Serotonin Syndrome risk' },
      { source: 'Escitalopram', target: 'Tramadol', severity: 'High', mechanism: 'Serotonin Syndrome risk' },
      { source: 'Duloxetine', target: 'Tramadol', severity: 'High', mechanism: 'Serotonin Syndrome risk' },
      { source: 'Trazodone', target: 'Sertraline', severity: 'Moderate', mechanism: 'Serotonin Syndrome risk' },
      
      // Other Common
      { source: 'Levothyroxine', target: 'Calcium', severity: 'Moderate', mechanism: 'Reduced absorption' },
      { source: 'Metformin', target: 'Alcohol', severity: 'Moderate', mechanism: 'Lactic acidosis risk' },
      { source: 'Gabapentin', target: 'Hydrocodone', severity: 'Moderate', mechanism: 'Increased CNS depression' },
      { source: 'Alprazolam', target: 'Hydrocodone', severity: 'High', mechanism: 'Severe CNS depression / Respiratory depression' },
      { source: 'Alprazolam', target: 'Tramadol', severity: 'High', mechanism: 'Severe CNS depression' }
    ];

    // State
    let nodes = new vis.DataSet([]);
    let edges = new vis.DataSet([]);
    let activeDrugs = new Set();
    let network = null; // Will be initialized after DOM is ready

    function addDrugFromInput() {
      const input = document.getElementById('drug-search');
      const drugName = input.value.trim();
      if (drugName) {
        addDrug(drugName);
        input.value = '';
      }
    }

    function addDrug(name) {
      // Normalize name (Sentence Case)
      name = name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();

      if (activeDrugs.has(name)) return;

      // Add Node
      activeDrugs.add(name);
      nodes.add({ id: name, label: name });

      // Check Interactions
      checkInteractions(name);
      updateList();
    }

    function removeDrug(name) {
      activeDrugs.delete(name);
      nodes.remove(name);
      
      // Remove associated edges
      const edgesToRemove = edges.get().filter(e => e.from === name || e.to === name);
      edges.remove(edgesToRemove.map(e => e.id));
      
      updateList();
      updateAlerts();
    }

    function checkInteractions(newDrug) {
      activeDrugs.forEach(existingDrug => {
        if (existingDrug === newDrug) return;

        // Find interaction in database
        const interaction = INTERACTIONS.find(i => 
          (i.source === newDrug && i.target === existingDrug) ||
          (i.source === existingDrug && i.target === newDrug)
        );

        if (interaction) {
          // Generate unique edge ID
          const edgeId = `${newDrug}-${existingDrug}`;
          
          // Check if edge already exists
          const existingEdge = edges.get().find(e => 
            (e.from === newDrug && e.to === existingDrug) ||
            (e.from === existingDrug && e.to === newDrug)
          );
          
          if (!existingEdge) {
            // Add Edge with explicit ID
            edges.add({
              id: edgeId,
              from: newDrug,
              to: existingDrug,
              color: { color: interaction.severity === 'High' ? '#c0392b' : '#f39c12' },
              width: interaction.severity === 'High' ? 4 : 2,
              label: interaction.severity,
              title: interaction.mechanism
            });
          }
        }
      });
      updateAlerts();
    }

    function updateList() {
      const list = document.getElementById('med-list');
      list.innerHTML = '';
      activeDrugs.forEach(drug => {
        const div = document.createElement('div');
        div.className = 'med-item';
        div.innerHTML = `
          <span>${drug}</span>
          <button onclick="removeDrug('${drug}')">√ó</button>
        `;
        list.appendChild(div);
      });
    }

    function updateAlerts() {
      const alertBox = document.getElementById('alert-box');
      const content = document.getElementById('alert-content');
      const activeEdges = edges.get();

      if (activeEdges.length === 0) {
        alertBox.style.display = 'none';
        return;
      }

      alertBox.style.display = 'block';
      content.innerHTML = activeEdges.map(e => `
        <div style="margin-top:0.5rem; font-size:0.85rem;">
          ‚Ä¢ ${e.from} + ${e.to}: <span class="${e.label === 'High' ? 'severity-high' : 'severity-mod'}">${e.title}</span>
        </div>
      `).join('');
    }

    // Initialize everything after DOM is ready
    document.addEventListener("DOMContentLoaded", () => {
      // Check if vis is loaded
      if (typeof vis === 'undefined') {
        console.error('Vis.js library not loaded!');
        document.getElementById('mynetwork').innerHTML = '<div style="padding: 2rem; text-align: center; color: #666;">Network visualization library failed to load. Please refresh the page.</div>';
        return;
      }
      
      // Initialize Network
      const container = document.getElementById('mynetwork');
      if (!container) {
        console.error('Network container not found!');
        return;
      }
      
      const data = { nodes: nodes, edges: edges };
      const options = {
        nodes: {
          shape: 'dot',
          size: 25,
          font: { size: 16, color: '#333' },
          borderWidth: 2,
          color: { background: '#e8f8f5', border: '#2ecc71' }
        },
        edges: {
          width: 2,
          color: { color: '#bdc3c7' },
          smooth: { type: 'continuous' }
        },
        physics: {
          stabilization: false,
          barnesHut: { gravitationalConstant: -2000, springConstant: 0.04 }
        }
      };
      
      try {
        network = new vis.Network(container, data, options);
        console.log('Network initialized successfully');
        
        // Initial Demo Data (after network is initialized)
        setTimeout(() => {
          addDrug('Warfarin');
          addDrug('Aspirin');
        }, 100);
      } catch (error) {
        console.error('Failed to initialize network:', error);
        container.innerHTML = '<div style="padding: 2rem; text-align: center; color: #666;">Failed to initialize network visualization. Please refresh the page.</div>';
      }

      // Initialize particles
      if (typeof particlesJS !== 'undefined') {
        particlesJS('particles-js', {
          particles: {
            number: { value: 60, density: { enable: true, value_area: 800 } },
            color: { value: '#2ecc71' },
            shape: { type: 'circle' },
            opacity: { value: 0.4, random: false },
            size: { value: 3, random: true },
            line_linked: {
              enable: true,
              distance: 150,
              color: '#2ecc71',
              opacity: 0.2,
              width: 1
            },
            move: {
              enable: true,
              speed: 1.5,
              direction: 'none',
              random: false,
              straight: false,
              out_mode: 'out',
              bounce: false,
            }
          },
          interactivity: {
            detect_on: 'canvas',
            events: {
              onhover: { enable: true, mode: 'repulse' },
              onclick: { enable: true, mode: 'push' },
              resize: true
            }
          },
          retina_detect: true
        });
      }
    });
  </script>

  <!-- Footer -->
  <footer>
    <p><strong>Disclaimer:</strong> This tool is for demonstration purposes only. It does not provide medical diagnosis, treatment, or clinical decision support. Drug interactions shown are examples and may not be comprehensive. Always consult a healthcare professional for medication management. Not intended for clinical use.</p>
    <p>&copy; 2025 David Dasa</p>
  </footer>
</body>
</html>

