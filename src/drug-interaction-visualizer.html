<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Interactive Drug Interaction Visualizer - Network Graph">
  <title>Drug Interaction Visualizer - David Dasa</title>
  <link rel="icon" type="image/svg+xml" href="/src/favicon-DD-monogram.svg">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    .viz-container {
      max-width: 1200px;
      margin: 2rem auto;
      background: rgba(255,255,255,0.82);
      border-radius: 1rem;
      box-shadow: 0 6px 18px rgba(0,0,0,0.04);
      border: 1px solid rgba(0,0,0,0.06);
      padding: 1.5rem;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 1.5rem;
      height: calc(100vh - 150px);
      min-height: 600px;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      border-right: 1px solid rgba(0,0,0,0.1);
      padding-right: 1.5rem;
    }

    .search-box {
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid #ddd;
      border-radius: 0.5rem;
      font-size: 1rem;
    }

    .med-list {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 0.5rem;
      background: white;
    }

    .med-item {
      padding: 0.8rem;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .med-item:hover {
      background: #f9f9f9;
    }

    .med-item button {
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 12px;
    }

    #mynetwork {
      width: 100%;
      height: 100%;
      border: 1px solid #eee;
      border-radius: 0.5rem;
      background: #fcfcfc;
    }

    .interaction-alert {
      margin-top: 1rem;
      padding: 1rem;
      background: #fdedec;
      border: 1px solid #fadbd8;
      border-radius: 0.5rem;
      color: #c0392b;
      font-size: 0.9rem;
      display: none;
    }

    .severity-high { color: #c0392b; font-weight: bold; }
    .severity-mod { color: #d35400; }
  </style>
</head>
<body>
  <nav>
    <ul>
      <li class="logo"><a href="https://www.daviddasa.com"><img src="https://github.com/Naijaoracle/daviddasa/blob/9556670c224c56b73e2a7f21ce1a4e27cbc1a90e/src/DD_logo.png?raw=true" alt="Logo" width="50" height="50"></a></li>
      <li class="home-link"><a href="https://www.daviddasa.com/">Home</a></li>
      <li><a href="https://www.daviddasa.com/projects">Projects</a></li>
    </ul>
  </nav>

  <!-- Particles Background -->
  <div id="particles-js"></div>

  <div class="container">
    <div class="article-header" style="margin-top: 2rem;">
      <h1>üíä Drug Interaction Visualizer</h1>
      <p>Interactive network graph demonstrating polypharmacy risks. Add medications to visualize potential interactions and severity levels.</p>
    </div>

    <div class="viz-container">
      <div class="controls">
        <div class="search-box">
          <input type="text" class="search-input" id="drug-search" placeholder="Add medication (e.g. Warfarin)..." list="drug-options">
          <datalist id="drug-options">
            <option value="Warfarin">
            <option value="Aspirin">
            <option value="Ibuprofen">
            <option value="Lisinopril">
            <option value="Simvastatin">
            <option value="Metformin">
            <option value="Amiodarone">
            <option value="Clopidogrel">
            <option value="Naproxen">
            <option value="Furosemide">
          </datalist>
          <button onclick="addDrugFromInput()" style="width:100%; margin-top:0.5rem; padding:0.6rem; background:#2ecc71; color:white; border:none; border-radius:0.5rem; cursor:pointer;">+ Add Drug</button>
        </div>

        <h3>Current Meds</h3>
        <div class="med-list" id="med-list">
          <!-- Added meds go here -->
        </div>

        <div class="interaction-alert" id="alert-box">
          <strong>‚ö†Ô∏è Interaction Alert</strong>
          <div id="alert-content"></div>
        </div>
      </div>

      <div id="mynetwork"></div>
    </div>
  </div>

  <script>
    // Knowledge Graph (Sample Data)
    const INTERACTIONS = [
      { source: 'Warfarin', target: 'Aspirin', severity: 'High', mechanism: 'Increased bleeding risk' },
      { source: 'Warfarin', target: 'Ibuprofen', severity: 'High', mechanism: 'GI bleeding risk' },
      { source: 'Warfarin', target: 'Naproxen', severity: 'High', mechanism: 'GI bleeding risk' },
      { source: 'Warfarin', target: 'Amiodarone', severity: 'High', mechanism: 'Increased Warfarin effect' },
      { source: 'Warfarin', target: 'Simvastatin', severity: 'Moderate', mechanism: 'Increased bleeding risk' },
      { source: 'Aspirin', target: 'Ibuprofen', severity: 'Moderate', mechanism: 'Reduced cardioprotection' },
      { source: 'Lisinopril', target: 'Potassium', severity: 'High', mechanism: 'Hyperkalemia risk' },
      { source: 'Lisinopril', target: 'Furosemide', severity: 'Moderate', mechanism: 'Hypotension risk' },
      { source: 'Simvastatin', target: 'Amiodarone', severity: 'High', mechanism: 'Myopathy risk' },
      { source: 'Clopidogrel', target: 'Omeprazole', severity: 'Moderate', mechanism: 'Reduced antiplatelet effect' }
    ];

    // State
    let nodes = new vis.DataSet([]);
    let edges = new vis.DataSet([]);
    let activeDrugs = new Set();

    // Network Setup
    const container = document.getElementById('mynetwork');
    const data = { nodes: nodes, edges: edges };
    const options = {
      nodes: {
        shape: 'dot',
        size: 25,
        font: { size: 16, color: '#333' },
        borderWidth: 2,
        color: { background: '#e8f8f5', border: '#2ecc71' }
      },
      edges: {
        width: 2,
        color: { color: '#bdc3c7' },
        smooth: { type: 'continuous' }
      },
      physics: {
        stabilization: false,
        barnesHut: { gravitationalConstant: -2000, springConstant: 0.04 }
      }
    };
    const network = new vis.Network(container, data, options);

    function addDrugFromInput() {
      const input = document.getElementById('drug-search');
      const drugName = input.value.trim();
      if (drugName) {
        addDrug(drugName);
        input.value = '';
      }
    }

    function addDrug(name) {
      // Normalize name (Sentence Case)
      name = name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();

      if (activeDrugs.has(name)) return;

      // Add Node
      activeDrugs.add(name);
      nodes.add({ id: name, label: name });

      // Check Interactions
      checkInteractions(name);
      updateList();
    }

    function removeDrug(name) {
      activeDrugs.delete(name);
      nodes.remove(name);
      
      // Remove associated edges
      const edgesToRemove = edges.get().filter(e => e.from === name || e.to === name);
      edges.remove(edgesToRemove.map(e => e.id));
      
      updateList();
      updateAlerts();
    }

    function checkInteractions(newDrug) {
      activeDrugs.forEach(existingDrug => {
        if (existingDrug === newDrug) return;

        // Find interaction in database
        const interaction = INTERACTIONS.find(i => 
          (i.source === newDrug && i.target === existingDrug) ||
          (i.source === existingDrug && i.target === newDrug)
        );

        if (interaction) {
          // Add Edge
          edges.add({
            from: newDrug,
            to: existingDrug,
            color: { color: interaction.severity === 'High' ? '#c0392b' : '#f39c12' },
            width: interaction.severity === 'High' ? 4 : 2,
            label: interaction.severity,
            title: interaction.mechanism
          });
        }
      });
      updateAlerts();
    }

    function updateList() {
      const list = document.getElementById('med-list');
      list.innerHTML = '';
      activeDrugs.forEach(drug => {
        const div = document.createElement('div');
        div.className = 'med-item';
        div.innerHTML = `
          <span>${drug}</span>
          <button onclick="removeDrug('${drug}')">√ó</button>
        `;
        list.appendChild(div);
      });
    }

    function updateAlerts() {
      const alertBox = document.getElementById('alert-box');
      const content = document.getElementById('alert-content');
      const activeEdges = edges.get();

      if (activeEdges.length === 0) {
        alertBox.style.display = 'none';
        return;
      }

      alertBox.style.display = 'block';
      content.innerHTML = activeEdges.map(e => `
        <div style="margin-top:0.5rem; font-size:0.85rem;">
          ‚Ä¢ ${e.from} + ${e.to}: <span class="${e.label === 'High' ? 'severity-high' : 'severity-mod'}">${e.title}</span>
        </div>
      `).join('');
    }

    // Initial Demo Data
    addDrug('Warfarin');
    addDrug('Aspirin');

    // Initialize particles
    document.addEventListener("DOMContentLoaded", () => {
      particlesJS('particles-js', {
        particles: {
          number: { value: 60, density: { enable: true, value_area: 800 } },
          color: { value: '#2ecc71' },
          shape: { type: 'circle' },
          opacity: { value: 0.4, random: false },
          size: { value: 3, random: true },
          line_linked: {
            enable: true,
            distance: 150,
            color: '#2ecc71',
            opacity: 0.2,
            width: 1
          },
          move: {
            enable: true,
            speed: 1.5,
            direction: 'none',
            random: false,
            straight: false,
            out_mode: 'out',
            bounce: false,
          }
        },
        interactivity: {
          detect_on: 'canvas',
          events: {
            onhover: { enable: true, mode: 'repulse' },
            onclick: { enable: true, mode: 'push' },
            resize: true
          }
        },
        retina_detect: true
      });
    });
  </script>
</body>
</html>

